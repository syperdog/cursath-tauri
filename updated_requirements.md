# Обновленная документация требований к системе управления станцией технического обслуживания

## 1. Общее описание системы

Система управления станцией технического обслуживания (СТО) представляет собой комплексное приложение, разработанное с использованием фреймворка Tauri, которое объединяет современные технологии фронтенда (React, TypeScript) и надежную бэкенд-архитектуру (Rust) с PostgreSQL в качестве основной системы хранения данных.

### 1.1 Цель системы

Целью системы является автоматизация всех процессов, связанных с обслуживанием автомобилей на станции технического обслуживания, включая управление заказами-нарядами, клиентами, автомобилями, запчастями, персоналом и финансовыми операциями. Система обеспечивает эффективное взаимодействие между всеми участниками процесса обслуживания: администратором, мастером-приёмщиком, диагностом, кладовщиком и работниками цеха.

### 1.2 Основные особенности

- **Многоуровневая аутентификация**: Вход по логину/паролю для персонала (администратор, мастер, диагност, кладовщик) и по PIN-коду для работников цеха
- **Многоуровневый доступ**: Разграничение прав доступа в зависимости от роли пользователя
- **Комплексное управление заказами**: От создания до завершения и архивации
- **Интеграция с внешними каталогами**: Возможность поиска запчастей по каталогам поставщиков
- **Детализированный лог**: Ведение журнала всех событий в системе
- **Поддержка справочников**: Управление справочниками услуг, узлов и типов неисправностей

## 2. Ролевая модель и функциональность

### 2.1 Администратор (Владелец)

**Права доступа**: Полный доступ ко всем модулям системы

**Основные функции**:
- Управление учетными записями сотрудников (создание, редактирование, удаление)
- Просмотр интерфейсов и действий пользователей для контроля работы персонала
- Управление справочниками (услуги, узлы и типы неисправностей)
- Просмотр журналов событий системы
- Настройка системных параметров

**Основные команды API**:
- `get_all_users`, `create_user`, `update_user`, `delete_user`
- `get_system_logs`
- `get_all_defect_types`, `create_defect_node`, `create_defect_type`
- `get_all_services`, `create_service`, `update_service`, `delete_service`

### 2.2 Мастер-Приёмщик

**Права доступа**: Доступ к управлению заказами, клиентами, автомобилями

**Основные функции**:
- Создание заказов-нарядов
- Поиск/регистрация клиентов и автомобилей
- Назначение работников на выполнение работ
- Управление статусами заказов
- Согласование работ с клиентами
- Формирование итоговых документов

**Основные команды API**:
- `get_orders_for_master`
- `create_order`, `create_client`, `create_car`
- `get_client_by_id`, `get_car_by_id`, `get_cars_by_client_id`
- `search_orders_clients_cars`
- `assign_workers_to_order`, `update_order_status`

### 2.3 Диагност

**Права доступа**: Доступ к заказам, требующим диагностики; создание неисправностей

**Основные функции**:
- Просмотр заказов, поступивших на диагностику
- Формирование отчетов о диагностировании
- Добавление выявленных неисправностей с использованием справочника
- Привязка работ к неисправностям

**Основные команды API**:
- `get_orders_for_diagnostician`
- `save_diagnostic_results`
- `get_all_defect_types_grouped`

### 2.4 Кладовщик (Снабженец)

**Права доступа**: Доступ к заказам, требующим подбора запчастей; управление складом

**Основные функции**:
- Просмотр заказов, требующих подбора запчастей
- Формирование предложений по запчастям
- Управление складскими остатками
- Выдача запчастей в цех
- Поиск запчастей в каталогах поставщиков

**Основные команды API**:
- `get_orders_for_storekeeper`
- `add_part_to_order`
- `add_warehouse_item`
- `search_parts_by_vin`
- `confirm_order_parts_and_works`

### 2.5 Работник (Слесарь, моторист, электрик и др.)

**Права доступа**: Доступ к назначенным заказам; выполнение работ

**Основные функции**:
- Просмотр назначенных заказов
- Просмотр деталей заказа (работы, запчасти, отчет диагностики)
- Отметка выполненных работ
- Отслеживание статуса запчастей

**Основные команды API**:
- `get_orders_for_worker`
- `get_order_details_for_worker`

## 3. Архитектура системы

### 3.1 Технологический стек

- **Frontend**: React + TypeScript + Vite
- **Backend**: Rust с использованием фреймворка Tauri
- **База данных**: PostgreSQL
- **Библиотеки для Rust**: sqlx, bcrypt, serde, uuid
- **Интерфейс**: Single Window Interface с модальными окнами

### 3.2 Структура базы данных

Система использует следующие основные таблицы:

- `users`: информация о пользователях системы
- `clients`: данные о клиентах
- `cars`: информация об автомобилях
- `orders`: заказы-наряды
- `order_works`: работы в заказах
- `order_parts`: запчасти в заказах
- `order_defects`: выявленные неисправности
- `warehouse`: складские остатки
- `services_reference`: справочник услуг
- `defect_nodes`: узлы неисправностей
- `defect_types`: типы неисправностей
- `system_logs`: журнал событий

### 3.3 Механизмы безопасности

- Хэширование паролей с использованием bcrypt
- Сессионное управление через встроенный механизм
- Разграничение доступа на основе ролей
- Журналирование всех важных операций в системе

## 4. Функциональные требования

### 4.1 Аутентификация и сессии

**4.1.1.1** Система должна поддерживать аутентификацию пользователей по логину и паролю
- *Реализовано в команде `login_user`*

**4.1.1.2** Система должна поддерживать аутентификацию работников по PIN-коду
- *Реализовано в команде `login_worker`*

**4.1.1.3** Система должна создавать сессии для аутентифицированных пользователей
- *Реализовано через статичный HashMap SESSIONS*

**4.1.1.4** Система должна проверять валидность сессии при выполнении защищенных операций
- *Реализовано через команду `get_user_session`*

### 4.2 Управление заказами

**4.2.1.1** Система должна позволять создавать новые заказы-наряды
- *Реализовано в команде `create_order`*

**4.2.1.2** Система должна отображать список заказов с фильтрацией по статусу
- *Реализовано в командах `get_orders_for_master`, `get_orders_for_storekeeper`, `get_orders_for_diagnostician`*

**4.2.1.3** Система должна позволять изменять статусы заказов
- *Реализовано в команде `update_order_status`*

**4.2.1.4** Система должна позволять назначать работников на выполнение работ в заказе
- *Реализовано в команде `assign_workers_to_order`*

### 4.3 Управление клиентами и автомобилями

**4.3.1.1** Система должна позволять создавать новых клиентов
- *Реализовано в команде `create_client`*

**4.3.1.2** Система должна позволять создавать новые автомобили
- *Реализовано в команде `create_car`*

**4.3.1.3** Система должна позволять искать клиентов и автомобили
- *Реализовано в команде `search_orders_clients_cars`*

**4.3.1.4** Система должна хранить историю обслуживания автомобилей
- *Реализовано через связь заказов с автомобилями в таблице `orders`*

### 4.4 Управление работами и запчастями

**4.4.1.1** Система должна позволять добавлять работы к заказам через справочник услуг
- *Реализовано в команде `save_diagnostic_results`*

**4.4.1.2** Система должна позволять добавлять запчасти к заказам
- *Реализовано в команде `add_part_to_order`*

**4.4.1.3** Система должна позволять согласовывать работы и запчасти с клиентом
- *Реализовано в команде `confirm_order_parts_and_works`*

### 4.5 Управление складом

**4.5.1.1** Система должна позволять добавлять новые позиции на склад
- *Реализовано в команде `add_warehouse_item`*

**4.5.1.2** Система должна отображать текущие остатки на складе
- *Данные доступны через таблицу `warehouse`*

**4.5.1.3** Система должна позволять выдавать запчасти в цех
- *Реализовано в команде `confirm_order_parts_and_works`*

### 4.6 Диагностика

**4.6.1.1** Система должна позволять диагностику формировать отчеты о неисправностях
- *Реализовано в команде `save_diagnostic_results`*

**4.6.1.2** Система должна использовать справочник узлов и типов неисправностей
- *Реализовано через таблицы `defect_nodes` и `defect_types`*

**4.6.1.3** Система должна автоматически создавать соответствующие работы при добавлении неисправностей
- *Реализовано в команде `save_diagnostic_results`*

### 4.7 Управление персоналом

**4.7.1.1** Система должна позволять создавать учетные записи сотрудников
- *Реализовано в команде `create_user`*

**4.7.1.2** Система должна позволять редактировать учетные записи сотрудников
- *Реализовано в команде `update_user`*

**4.7.1.3** Система должна позволять удалять учетные записи сотрудников
- *Реализовано в команде `delete_user`*

### 4.8 Логирование

**4.8.1.1** Система должна вести журнал всех значимых событий
- *Реализовано через таблицу `system_logs` и команду `log_event`*

**4.8.1.2** Система должна позволять просматривать журнал событий с фильтрацией
- *Реализовано в команде `get_system_logs`*

### 4.9 Справочники

**4.9.1.1** Система должна содержать справочник услуг с указанием нормо-часов и базовой цены
- *Реализовано через таблицу `services_reference` и команды `create_service`, `update_service`, `delete_service`*

**4.9.1.2** Система должна содержать справочник узлов и типов неисправностей
- *Реализовано через таблицы `defect_nodes` и `defect_types`*

**4.9.1.3** Система должна позволять устанавливать связи между типами неисправностей и услугами
- *Реализовано через таблицу `defect_type_services` и команды `get_service_defect_types`, `link_service_to_defect_type`*

## 5. Интерфейс пользователя (ASCII Mockups)

### 5.1 Вход в систему

**5.1.1** Вход для персонала (администратор, мастер, диагност, кладовщик):

```
╔═══════════════════════════════════════════════════════════════════════╗
║                                                                       ║
║                    🛠️  AutoService Pro v2.0                          ║
║                                                                       ║
║           ┌─────────────────────────────────────────────────┐         ║
║           │  👤 ЛОГИН:  [ admin__________________________ ] │         ║
║           └─────────────────────────────────────────────────┘         ║
║                                                                       ║
║           ┌─────────────────────────────────────────────────┐         ║
║           │  🔑 ПАРОЛЬ: [ ***********____________________ ] │         ║
║           └─────────────────────────────────────────────────┘         ║
║                                                                       ║
║                     [ 🚀 ВОЙТИ В СИСТЕМУ ]                            ║
║                                                                       ║
╚═══════════════════════════════════════════════════════════════════════╝
```

**5.1.2** Вход для работников (PIN-код):

```
╔═══════════════════════════════════════════════════════════════════════╗
║                                                                       ║
║               🔧 ВХОД ДЛЯ СОТРУДНИКОВ (ТЕРМИНАЛ ЦЕХА)                 ║
║                                                                       ║
║                       ┌─────────────────────┐                         ║
║                       │    *  *  *  _       │                         ║
║                       └─────────────────────┘                         ║
║                                                                       ║
║               ┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐                      ║
║               │  1  │  │  2  │  │  3  │  │  4  │                      ║
║               └─────┘  └─────┘  └─────┘  └─────┘                      ║
║               ┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐                      ║
║               │  5  │  │  6  │  │  7  │  │  8  │                      ║
║               └─────┘  └─────┘  └─────┘  └─────┘                      ║
║               ┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐                      ║
║               │  9  │  │  0  │  │ 🔙  │  │ 🆗  │                      ║
║               └─────┘  └─────┘  └─────┘  └─────┘                      ║
║                                                                       ║
╚═══════════════════════════════════════════════════════════════════════╝
```

### 5.2 Главный экран мастера-приёмщика

```
╔═══════════════════════════════════════════════════════════════════════╗
║  🛠️  AutoService Pro                                     [ ✖ ВЫХОД ] ║
╠═══════════════════════════════════════════════════════════════════════╣
║  🔍 [ Поиск заказа, клиента или авто...                     ]  [ 🔍 ] ║
╠═══════════════════════════════════════════════════════════════════════╣
║                                                                       ║
║  📅 КАЛЕНДАРЬ:   [ ◀ ]    Ноябрь 2025    [ ▶ ]   [ 🗄️ АРХИВ ]        ║
║  ┌────┬────┬────┬────┬────┬────┬────┐                                 ║
║  │ Пн │ Вт │ Ср │ Чт │ Пт │ Сб │ Вс │                                 ║
║  ├────┼────┼────┼────┼────┼────┼────┤                                 ║
║  │    │    │    │    │    │ 1  │ 2  │                                 ║
║  │ 3  │ 4  │ 5  │ 6  │ 7  │ 8  │ 9  │                                 ║
║  │ 10 │ 11 │ 12 │ 13 │ 14 │ 15 │ 16 │                                 ║
║  │ 17 │ 18 │ 19 │ 20 │ 21 │ 22 │ 23 │                                 ║
║  │ 24 │ 25 │ 26 │ 27 │ 28 │██29│ 30 │                                 ║
║  └────┴────┴────┴────┴────┴────┴────┘                                 ║
║                                                                       ║
║  📋 ЗАКАЗЫ НА 29.11.2025:                                             ║
║  ┌─────┬───────────────────┬───────────────────┬────────────┬───────┐ ║
║  │  #  │ Клиент            │ Автомобиль        │ Статус     │ Сумма │ ║
║  ├─────┼───────────────────┼───────────────────┼────────────┼───────┤ ║
║  │ 105 │ Петров П.П.       │ Toyota Camry      │ 🔧 В работе│ 5000  │ ║
║  │ 106 │ Сидоров А.А.      │ Ford Focus        │ ✅ Готов   │ 3500  │ ║
║  │ 107 │ Иванов И.И.       │ BMW X5            │ 🔍 Диагностика| ----  │ ║
║  └─────┴───────────────────┴───────────────────┴────────────┴───────┘ ║
║                                                                       ║
╚═══════════════════════════════════════════════════════════════════════╝
```

### 5.3 Детали заказа

```
╔═══════════════════════════════════════════════════════════════════════╗
║  📄 Заказ-наряд #105                                     [ ✖ ЗАКРЫТЬ ]║
╠═══════════════════════════════════════════════════════════════════════╣
║  👤 КЛИЕНТ: Петров П.П. (+375 () ___-__-__)                            ║
║  🚗 АВТО:   Toyota Camry (A 123 AA 77) | VIN: ...X12345               ║
║  🔧 СТАТУС ЗАКАЗА: [ 🔧 В РАБОТЕ ]                                    ║
╠═══════════════════════════════════════════════════════════════════════╣
║  📋 СПИСОК НЕИСПРАВНОСТЕЙ И РАБОТ:                                    ║
║  ┌─────────────────────────────────────────────────────────────────┐  ║
║  │ [-] 1. Стук в передней подвеске ................. [ ⏳ В РАБОТЕ ]│  ║
║  │  │                                                              │  ║
║  │  ├── 🛠️ РАБОТЫ:                                                 │  ║
║  │  │   • Диагностика ходовой ........................ 1000 $   │  ║
║  │  │   • Замена стоек стабилизатора ................. 3000 $   │  ║
║  │  │                                                              │  ║
║  │  └── 📦 ЗАПЧАСТИ:                                               │  ║
║  │      • Стойка стабилизатора (Toyota) x2 ........... 5000 $   │  ║
║  │                                                                 │  ║
║  │ [+] 2. Плановое ТО (Замена масла) ............... [ ✅ ГОТОВО   ]│  ║
║  │ [+] 3. Не горит правый габарит .................. [ ❌ НЕ НАЧАТО]│  ║
║  └─────────────────────────────────────────────────────────────────┘  ║
╠═══════════════════════════════════════════════════════════════════════╣
║                                              ИТОГО: 9000 $         ║
╚═══════════════════════════════════════════════════════════════════════╝
```

## 6. Сценарии использования

### 6.1 Регистрация нового заказа

1. Мастер-приёмщик входит в систему
2. Осуществляет поиск клиента по телефону или госномеру
3. Если клиента нет в базе, создает нового клиента
4. Добавляет автомобиль к клиенту (если нужно)
5. Создает новый заказ-наряд с указанием жалобы клиента и текущего пробега
6. Статус заказа автоматически устанавливается в "Диагностика"

### 6.2 Диагностика автомобиля

1. Диагност видит заказы, ожидающие диагностики
2. Выбирает заказ и проводит диагностику
3. Используя справочник неисправностей, фиксирует выявленные проблемы
4. Система автоматически создает соответствующие работы
5. Заказ передается кладовщику для подбора запчастей

### 6.3 Подбор запчастей

1. Кладовщик видит заказы, требующие подбора запчастей
2. Используя внутренний склад или внешние каталоги, подбирает запчасти
3. Фиксирует стоимость и сроки поставки
4. Заказ возвращается мастеру-приёмщику для согласования с клиентом

### 6.4 Согласование с клиентом

1. Мастер-приёмщик видит предложение по запчастям и работам
2. Связывается с клиентом для согласования
3. Отмечает согласованные позиции
4. Назначает работников на выполнение работ
5. Статус заказа меняется на "В работе"

### 6.5 Выполнение работ

1. Работник видит назначенные ему заказы
2. Получает запчасти у кладовщика
3. Выполняет работы, отмечая их выполнение в системе
4. По завершении всех работ, изменяет статус заказа на "Готов к выдаче"

### 6.6 Выдача автомобиля

1. Мастер-приёмщик проверяет выполненные работы
2. Оформляет окончательный расчет с клиентом
3. Получает оплату
4. Передает автомобиль клиенту
5. Закрывает заказ, переводя его в архив

## 7. Технические требования

### 7.1 Требования к производительности
- Время отклика на большинство операций не должно превышать 2 секунд
- Поддержка одновременной работы не менее 10 пользователей
- Время запуска приложения не должно превышать 10 секунд

### 7.2 Требования к надежности
- Все данные должны сохраняться в надежной реляционной базе данных PostgreSQL
- Резервное копирование данных должно быть реализовано на уровне СУБД
- Система должна обеспечивать целостность данных при одновременной работе нескольких пользователей

### 7.3 Требования к безопасности
- Пароли пользователей должны хэшироваться с использованием bcrypt
- Доступ к системе должен быть защищен многоуровневой аутентификацией
- Все критические операции должны быть зафиксированы в журнале событий

### 7.4 Требования к доступности
- Система должна быть доступна с настольных компьютеров и планшетов
- Интерфейс для работников должен быть адаптирован для использования на сенсорных экранах
- Поддержка русского языка в интерфейсе и документации

## 8. Установка и развертывание

### 8.1 Системные требования
- Операционная система: Windows, macOS или Linux
- Память: не менее 4 ГБ ОЗУ
- Свободное место на диске: не менее 500 МБ
- PostgreSQL: версия 12 или выше
- Node.js: версия 18 или выше
- Rust: версия 1.70 или выше

### 8.2 Процесс установки
1. Установить Node.js, Rust и PostgreSQL
2. Скачать исходный код системы
3. Установить зависимости: `pnpm install`
4. Настроить подключение к базе данных в файле конфигурации
5. Запустить систему: `pnpm run tauri dev`

### 8.3 Настройка базы данных
- Подключение к существующей БД cursat с пользователем gisei
- Использование готовых скриптов миграции из файлов postgres_schema.sql
- Загрузка начальных данных из populate_database.sql

## 9. Тестирование

### 9.1 Модульное тестирование
- Тестирование всех команд Rust API
- Тестирование бизнес-логики обработки заказов
- Тестирование аутентификации и авторизации

### 9.2 Интеграционное тестирование
- Тестирование взаимодействия между фронтендом и бэкендом
- Тестирование целостности данных в БД
- Тестирование работы в многопользовательском режиме

### 9.3 Пользовательское тестирование
- Тестирование основных сценариев использования
- Тестирование интерфейса для всех ролей пользователей
- Тестирование производительности в условиях реальной нагрузки

## 10. Сопровождение и поддержка

### 10.1 Обновления системы
- Регулярные обновления зависимостей
- Исправление выявленных ошибок
- Улучшение интерфейса и пользовательского опыта

### 10.2 Поддержка пользователей
- Документация для каждой роли пользователя
- Обучающие материалы по использованию системы
- Техническая поддержка при возникновении проблем

### 10.3 Мониторинг и логирование
- Регулярный анализ журналов событий
- Мониторинг производительности системы
- Предупреждения о критических ошибках и сбоях
